<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>KCã®åœŸåœ°è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ </title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="apple-touch-icon" href="icon-180.png">
<style>
  :root{
    --bg:#0b1220; --panel:#111827; --soft:#1f2937; --text:#e5e7eb; --muted:#94a3b8; --accent:#22c55e; --warn:#f59e0b; --bad:#ef4444; --line:#334155;
    --brand:#22c55e; --radius:14px;
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0b1220,#0f172a 30%,#0b1220);color:var(--text)}
  header{position:sticky;top:0;background:rgba(15,23,42,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:10}
  .wrap{max-width:960px;margin:0 auto;padding:12px 16px}
  h1{font-size:18px;margin:0;display:flex;gap:10px;align-items:center}
  .brand{display:flex;align-items:center;gap:8px}
  .brand .logo{width:28px;height:28px;border-radius:8px;background:var(--brand);display:inline-block}
  .pill{font-size:12px;color:var(--muted);border:1px solid var(--line);padding:2px 8px;border-radius:999px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  button{height:40px;min-width:44px;background:var(--soft);color:var(--text);border:1px solid var(--line);padding:8px 12px;border-radius:12px;cursor:pointer}
  button:active{transform:scale(.99)}
  .warn{background:var(--warn);border-color:#d97706;color:#1f1300}
  .danger{background:var(--bad);border-color:#dc2626}

  main{padding-bottom:92px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:14px}
  .section-title{display:flex;justify-content:space-between;align-items:center;margin:6px 0 10px 0}
  .section-title h2{font-size:16px;margin:0}

  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}

  .row{display:grid;grid-template-columns:1.2fr .9fr .7fr;gap:8px;align-items:center;margin:8px 0}
  select, input[type="number"], input[type="text"], textarea{width:100%;background:#0b1220;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px}
  label{font-size:14px}

  .score-box{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:640px){.score-box{grid-template-columns:1fr 1fr}}
  .total{background:linear-gradient(180deg,#052e1a,#06230f);border:1px solid #14532d;border-radius:16px;padding:16px}
  .meter{height:14px;border-radius:999px;background:#0b1220;border:1px solid var(--line);overflow:hidden}
  .bar{height:100%;background:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e);width:0%}
  .grade{font-size:26px;margin:0}
  .tiny{font-size:12px;color:var(--muted)}
  .kpi{display:flex;gap:8px;flex-wrap:wrap}
  .kpi .chip{background:#0b1220;border:1px solid var(--line);border-radius:10px;padding:6px 10px}

  .note{min-height:110px}

  .app-footer{position:fixed;left:0;right:0;bottom:0;background:rgba(17,24,39,.96);border-top:1px solid var(--line);padding:10px 12px;z-index:20;backdrop-filter:blur(8px)}
  .foot-wrap{max-width:960px;margin:0 auto;display:flex;gap:10px;align-items:center;justify-content:space-between}
  .social{display:flex;gap:10px;align-items:center}
  .social a{display:flex;gap:6px;align-items:center;text-decoration:none;color:#c7d2fe;border:1px solid var(--line);padding:8px 10px;border-radius:12px}
  .copyright{font-size:12px;color:var(--muted)}

  input, button, select{font-size:16px}
</style>
</head>
<body>
<header>
  <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;gap:10px">
    <div class="brand">
      <span class="logo" aria-hidden="true"></span>
      <h1>KCã®åœŸåœ°è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ </h1>
      <span class="pill">ãƒ¢ãƒã‚¤ãƒ«æœ€é©</span>
    </div>
    <div class="toolbar">
      <button id="export">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
      <button id="import">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
      <button id="reset" class="danger">åˆæœŸåŒ–</button>
    </div>
  </div>
</header>

<main class="wrap" style="margin-top:10px">
  <div class="grid">
    <section class="card" id="left">
      <div class="section-title"><h2>è©•ä¾¡ï¼ˆ6é …ç›®ãƒ»100ç‚¹æº€ç‚¹ï¼‰</h2>
        <div class="tiny">å„é …ç›®ã®è©•ä¾¡ï¼5æ®µéšï¼ˆå¾Œè¿°ï¼‰ / é‡ã¿ã¯åˆè¨ˆ100%</div>
      </div>

      <div id="list"></div>

      <details style="margin-top:10px">
        <summary>è©•ä¾¡æ–¹æ³•ï¼ˆ5æ®µéšï¼‰</summary>
        <div class="tiny">
          <ol>
            <li>å¸Œæœ›ã‚ˆã‚Šã¨ã¦ã‚‚è‰¯ã„ï¼ˆ100ç‚¹æ›ç®—ï¼‰</li>
            <li>å¸Œæœ›ã‚ˆã‚Šè‰¯ã„ï¼ˆ75ç‚¹æ›ç®—ï¼‰</li>
            <li>ã»ã¼å¸Œæœ›é€šã‚Šï¼ï¼ˆ50ç‚¹æ›ç®—ï¼‰</li>
            <li>å¸Œæœ›ã‚’ã‚„ã‚„å¤–ã‚Œã‚‹ï¼ˆ25ç‚¹æ›ç®—ï¼‰</li>
            <li>å¸Œæœ›ã‹ã‚‰å¤§ããå¤–ã‚Œã‚‹ï¼ˆ0ç‚¹æ›ç®—ï¼‰</li>
          </ol>
          æœ€çµ‚ã‚¹ã‚³ã‚¢ï¼å„é …ç›®ã®ï¼ˆæ›ç®—ç‚¹Ã—é‡ã¿%ï¼‰ã®åˆè¨ˆï¼ˆ100ç‚¹æº€ç‚¹ï¼‰
        </div>
      </details>
    </section>

    <section class="card" id="right">
      <div class="section-title"><h2>çµæœ</h2>
        <div><button id="print" class="warn">PDF/å°åˆ·</button></div>
      </div>

      <div class="score-box">
        <div class="total">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
            <h3 class="grade" id="totalScore">0 ç‚¹</h3>
            <div class="kpi">
              <div class="chip">è©•ä¾¡: <b id="verdict">â€”</b></div>
              <div class="chip">é–¾å€¤: <span id="threshold">75ç‚¹ï¼ã€Œè²·ã„ã€</span></div>
            </div>
          </div>
          <div class="meter" style="margin:10px 0 6px"><div class="bar" id="bar"></div></div>
          <div class="tiny">åˆè¨ˆ100ç‚¹æº€ç‚¹ï¼ˆé‡ã¿Ã—æ›ç®—ç‚¹ã®åŠ é‡åˆè¨ˆï¼‰</div>
        </div>
        <div class="card" style="background:#0b1220">
          <div class="section-title" style="margin:0"><h2 style="font-size:14px">åˆ¤å®šãƒ«ãƒ¼ãƒ«</h2></div>
          <div class="tiny">
            <ul>
              <li>90ã€œ100ï¼š<b>å¸Œå°‘ã§å¼·ãæ¨å¥¨</b></li>
              <li>75ã€œ89ï¼š<b>è³¼å…¥æ¨å¥¨</b></li>
              <li>60ã€œ74ï¼š<b>æ¡ä»¶ä»˜ãè³¼å…¥</b></li>
              <li>ã€œ59ï¼š<b>è¦‹é€ã‚Šæ¨å¥¨</b></li>
            </ul>
          </div>
          <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
            <label class="tiny">ã€Œè²·ã„ã€é–¾å€¤ï¼š</label>
            <input type="number" id="buyThreshold" min="0" max="100" step="1" value="75" />
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:10px;background:#0b1220">
        <div class="section-title" style="margin:0"><h2 style="font-size:14px">æ‰€è¦‹ãƒ»ãƒ¡ãƒ¢</h2></div>
        <textarea id="notes" class="note" placeholder="ç¾åœ°ã®æ°—ã¥ãã€äº¤æ¸‰ææ–™ã€è¿½åŠ ã‚³ã‚¹ãƒˆè¦‹è¾¼ã¿ï¼ˆä¾‹ï¼šåœ°ç›¤æ”¹è‰¯120ä¸‡å††ã€æ“å£ç¢ºèªè¦ãªã©ï¼‰"></textarea>
      </div>

      <div class="tiny" style="margin-top:6px">ver 1.1 â€¢ Â© KC</div>
    </section>
  </div>
</main>

<footer class="app-footer" role="contentinfo">
  <div class="foot-wrap">
    <div class="social">
      <a id="linkYT" href="#" target="_blank" rel="noopener" aria-label="YouTube"><span>â–¶ï¸</span><span>YouTube</span></a>
      <a id="linkIG" href="#" target="_blank" rel="noopener" aria-label="Instagram"><span>ğŸ“¸</span><span>Instagram</span></a>
    </div>
    <div class="copyright">ã“ã®ã‚¢ãƒ—ãƒªã®è‘—ä½œæ¨©ã¯æ ªå¼ä¼šç¤¾KCã«å¸°å±ã—ã¾ã™ã€‚</div>
  </div>
</footer>

<script>
// ========== å®šæ•° ==========
const SOCIAL = {
  youtube: "https://www.youtube.com/results?search_query=KCã®å®¶ã¥ãã‚ŠLAB.",
  instagram: "https://www.instagram.com/"
};

// 5æ®µéš â†’ 0/25/50/75/100 ã«æ›ç®—
const MAP = {
  5: 100, // å¸Œæœ›ã‚ˆã‚Šã¨ã¦ã‚‚è‰¯ã„
  4: 75,  // å¸Œæœ›ã‚ˆã‚Šè‰¯ã„
  3: 50,  // ã»ã¼å¸Œæœ›é€šã‚Šï¼
  2: 25,  // å¸Œæœ›ã‚’ã‚„ã‚„å¤–ã‚Œã‚‹
  1: 0    // å¸Œæœ›ã‹ã‚‰å¤§ããå¤–ã‚Œã‚‹
};

// åˆæœŸã‚¦ã‚¨ã‚¤ãƒˆï¼ˆåˆè¨ˆ100ï¼‰: æ–½ä¸»ä¸€èˆ¬å‘ã‘æƒ³å®š
// é§…20 / å°å­¦æ ¡15 / ä¾¡æ ¼20 / åºƒã•10 / å»ºã¦ã‚„ã™ã•15 / ãƒã‚¶ãƒ¼ãƒ‰20
let model = {
  threshold: 75,
  notes: "",
  items: [
    {key:"eki",      name:"é§…è·é›¢",             weight:20, score:3},
    {key:"es",       name:"å°å­¦æ ¡è·é›¢",         weight:15, score:3},
    {key:"price",    name:"ä¾¡æ ¼",               weight:20, score:3},
    {key:"size",     name:"åºƒã•",               weight:10, score:3},
    {key:"build",    name:"å»ºç¯‰ã®ã—ã‚„ã™ã•",     weight:15, score:3},
    {key:"hazard",   name:"ãƒã‚¶ãƒ¼ãƒ‰",           weight:20, score:3}
  ]
};

// ========== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ==========
const $ = (s,root=document)=>root.querySelector(s);
function save(){ localStorage.setItem("kc_landscore_v2", JSON.stringify(model)); render(); }
function load(){ try{ return JSON.parse(localStorage.getItem("kc_landscore_v2")); }catch(e){ return null; } }

// åˆæœŸãƒ­ãƒ¼ãƒ‰
const saved = load();
if(saved && saved.items?.length === 6){ model = saved; }

// ========== ãƒ­ã‚¸ãƒƒã‚¯ ==========
function normalizeWeights(){
  let sum = model.items.reduce((a,it)=>a + Number(it.weight||0), 0);
  if(sum===100 || sum===0) return;
  // æ¯”ä¾‹ã§ä¸¸ã‚ã€ç«¯æ•°ã¯ä¸Šã‹ã‚‰èª¿æ•´
  model.items.forEach(it=>{ it.weight = Math.round((it.weight/sum)*100); });
  let diff = 100 - model.items.reduce((a,it)=>a+it.weight,0);
  for(let i=0; diff!==0 && i<model.items.length; i++){
    model.items[i].weight += diff>0?1:-1; diff += diff>0?-1:1;
  }
}

function calcTotal(){
  normalizeWeights();
  return Math.round(model.items.reduce((sum,it)=> sum + (MAP[it.score] * (it.weight/100)), 0));
}

function verdict(score){
  if(score>=90) return "å¸Œå°‘ã§å¼·ãæ¨å¥¨";
  if(score>=model.threshold) return "è³¼å…¥æ¨å¥¨";
  if(score>=60) return "æ¡ä»¶ä»˜ãè³¼å…¥";
  return "è¦‹é€ã‚Šæ¨å¥¨";
}

// ========== æç”» ==========
function render(){
  const list = document.getElementById("list");
  list.innerHTML = "";
  const options = [
    {v:5, l:"å¸Œæœ›ã‚ˆã‚Šã¨ã¦ã‚‚è‰¯ã„"},
    {v:4, l:"å¸Œæœ›ã‚ˆã‚Šè‰¯ã„"},
    {v:3, l:"ã»ã¼å¸Œæœ›é€šã‚Šï¼"},
    {v:2, l:"å¸Œæœ›ã‚’ã‚„ã‚„å¤–ã‚Œã‚‹"},
    {v:1, l:"å¸Œæœ›ã‹ã‚‰å¤§ããå¤–ã‚Œã‚‹"}
  ];

  model.items.forEach((it, idx)=>{
    const row = document.createElement('div');
    row.className = 'row';
    row.innerHTML = `
      <label>${idx+1}. ${it.name}</label>
      <select aria-label="è©•ä¾¡é¸æŠ">
        ${options.map(o=>`<option value="${o.v}" ${it.score===o.v?"selected":""}>${o.l}</option>`).join('')}
      </select>
      <div style="display:flex;gap:6px;align-items:center">
        <input type="number" min="0" max="100" step="1" value="${it.weight}" aria-label="é‡ã¿(%)">
        <span class="tiny">%</span>
      </div>
    `;
    const sel = row.querySelector('select');
    sel.onchange = e=>{ it.score = Number(e.target.value); save(); };
    const w = row.querySelector('input[type=number]');
    w.oninput = e=>{ it.weight = Number(e.target.value||0); save(); };
    list.appendChild(row);
  });

  // ãƒãƒ¼ãƒˆ
  const notes = document.getElementById('notes');
  notes.value = model.notes||"";
  notes.oninput = e=>{ model.notes = e.target.value; save(); };

  // çµæœ
  const total = calcTotal();
  document.getElementById('totalScore').textContent = total + ' ç‚¹';
  document.getElementById('bar').style.width = Math.max(0,Math.min(100,total)) + '%';
  document.getElementById('verdict').textContent = verdict(total);
  document.getElementById('threshold').textContent = `${model.threshold}ç‚¹ï¼ã€Œè²·ã„ã€`;
  document.getElementById('buyThreshold').value = model.threshold;
}

// ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
$('#buyThreshold').oninput = e=>{ model.threshold = Number(e.target.value||75); save(); };

$('#export').onclick = ()=>{
  const blob = new Blob([JSON.stringify(model,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url; a.download='kc_landscore.json'; a.click(); URL.revokeObjectURL(url);
};
$('#import').onclick = ()=>{
  const inp = document.createElement('input');
  inp.type='file'; inp.accept='application/json';
  inp.onchange = ()=>{
    const f = inp.files?.[0]; if(!f) return;
    const fr = new FileReader();
    fr.onload = ()=>{ try{ const d = JSON.parse(fr.result);
      if(!Array.isArray(d.items) || d.items.length!==6) throw new Error('å½¢å¼ãŒé•ã„ã¾ã™');
      model = d; save(); } catch(e){ alert('èª­ã¿è¾¼ã¿å¤±æ•—ï¼š'+e.message); } };
    fr.readAsText(f);
  };
  inp.click();
};
$('#reset').onclick = ()=>{
  if(confirm('åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿï¼ˆç¾åœ¨ã®å†…å®¹ã¯å¤±ã‚ã‚Œã¾ã™ï¼‰')){
    localStorage.removeItem('kc_landscore_v2'); location.reload();
  }
};
$('#print').onclick = ()=>{ window.print(); };

// SNSãƒªãƒ³ã‚¯é©ç”¨
const yt = document.getElementById('linkYT'); yt.href = SOCIAL.youtube;
const ig = document.getElementById('linkIG'); ig.href = SOCIAL.instagram;

render();
</script>
</body>
</html>
